<!DOCTYPE html>
<html class="no-js" lang="en">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>Order History</title>
    <meta name="description" content="description">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Favicon -->
    <!-- <link rel="shortcut icon" href="../static/images/favicon.png" /> -->
    <!-- Plugins CSS -->
    <link rel="stylesheet" href="../static/css/plugins.css">
    <!-- Bootstap CSS -->
    <link rel="stylesheet" href="../static/css/bootstrap.min.css">
    <!-- Main Style CSS -->
    <link rel="stylesheet" href="../static/css/style.css">
    <link rel="stylesheet" href="../static/css/responsive.css">
</head>

<body class="page-template belle">
    <div class="pageWrapper">
        <!--Search Form Drawer-->
        <div class="search">
            <div class="search__form">
                <form class="search-bar__form" action="#">
                    <button class="go-btn search__button" type="submit"><i class="icon anm anm-search-l"></i></button>
                    <input class="search__input" type="search" name="q" value="" placeholder="Search entire store..."
                        aria-label="Search" autocomplete="off">
                </form>
                <button type="button" class="search-trigger close-btn"><i class="icon anm anm-times-l"></i></button>
            </div>
        </div>
        <!--End Search Form Drawer-->


        <!--Body Content-->
        <div id="page-content">
            <!--Page Title-->
            <div class="page section-header text-center">
                <div class="page-title">
                    <div class="wrapper">
                        <h1 class="page-width">Order History</h1>
                    </div>
                </div>
                <div class="newsletter-section">
                    <div class="container">
                        <div class="row">
                            <div
                                class="col-12 col-sm-12 col-md-12 col-lg-7 w-100 d-flex justify-content-start align-items-center">
                                <div class="display-table">
                                    <div class="display-table-cell footer-newsletter">

                                        <form action="#" method="post">
                                            <div class="input-group">
                                                <input type="text" class="input-group__field newsletter__input"
                                                    name="text" value="" placeholder="Search for orders" required="">
                                                <span class="input-group__btn">
                                                    <button type="submit" class="btn newsletter__submit" name="commit"
                                                        id="Subscribe"><span
                                                            class="newsletter__submit-text--large">Search</span></button>
                                                </span>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                            <div class="col-12 col-sm-12 col-md-12 col-lg-7 w-100 d-flex justify-content-start align-items-center"
                                style="margin-top: 1%;">
                                <div class="display-table">
                                   <div class="row">
                                    <div class="col-lg-3 col-sm-6 col-md-3  display-table-cell footer-newsletter">


                                        <!-- <input type="text" class="input-group__field newsletter__input" name="text" value="" placeholder="Search for orders" required=""> -->
                                        <span class="input-group__btn">
                                            <a href="/addproduct" target="_blank"> <button type="submit"
                                                    class="btn newsletter__submit" name="commit" id="Subscribe"><span
                                                        class="newsletter__submit-text--large">Add
                                                        Product</span></button></a>
                                        </span>
                                    </div>
                                    <div class="col-lg-3 col-sm-6 col-md-3 display-table-cell footer-newsletter">


                                        <!-- <input type="text" class="input-group__field newsletter__input" name="text" value="" placeholder="Search for orders" required=""> -->
                                        <span class="input-group__btn">
                                             <button type="submit"
                                                    class="btn newsletter__submit" name="commit" onclick="showEditProduct()" id="editProductBtn"><span
                                                        class="newsletter__submit-text--large">Edit
                                                        Product</span></button>
                                        </span>
                                    </div>

                                    <div class="col-lg-3 col-sm-6 col-md-3 display-table-cell footer-newsletter">


                                        <!-- <input type="text" class="input-group__field newsletter__input" name="text" value="" placeholder="Search for orders" required=""> -->
                                        <span class="input-group__btn">
                                            <button type="submit"
                                                    class="btn newsletter__submit" name="commit" onclick="showOrderHistory()" id="ordersBtn"><span
                                                        class="newsletter__submit-text--large">Order History
                                                    </span></button>
                                        </span>
                                    </div>

                                    <div class="col-lg-3 col-sm-6 col-md-3 display-table-cell footer-newsletter">


                                        <!-- <input type="text" class="input-group__field newsletter__input" name="text" value="" placeholder="Search for orders" required=""> -->
                                        <span class="input-group__btn">
                                            <button type="submit"
                                                    class="btn newsletter__submit" name="commit" onclick="showReturnHistory()" id="returnBtn"><span
                                                        class="newsletter__submit-text--large">Return 
                                                    </span></button>
                                        </span>
                                    </div>
                                    <div class="col-lg-3 col-sm-6 col-md-3 display-table-cell footer-newsletter">


                                        <!-- <input type="text" class="input-group__field newsletter__input" name="text" value="" placeholder="Search for orders" required=""> -->
                                        <span class="input-group__btn">
                                            <button type="submit"
                                                    class="btn newsletter__submit" name="commit" onclick="showCancelled()" id="returnBtn"><span
                                                        class="newsletter__submit-text--large">Cancelled Orders 
                                                    </span></button>
                                        </span>
                                    </div>
                                   </div>

                                </div>

                            </div>


                        </div>
                    </div>
                </div>
            </div>
            <!--End Page Title-->

            <div class="container" id="orderHistoryTable" style="display: block;">
                <div class="row">
                    <div class="col-12 col-sm-12 col-md-12 col-lg-12 main-col">
                        <h2 style="color: #deb992;">Orders History</h2>
            
                        <form action="#">
                            <div class="wishlist-table table-content table-responsive">
                                <table class="table table-bordered">
                                    <thead>
                                        <tr>
                                            <th class="product-name text-center alt-font">Customer Name</th>
                                            <th class="product-price text-center alt-font">Phone No.</th>
                                            <th class="product-subtotal text-center alt-font">Email</th>
                                            <th class="product-name alt-font text-center">Product Details</th>
                                            <th class="product-name alt-font text-center">Billing Address</th>
                                            <th class="product-price text-center alt-font">Order Value</th>
                                            <th class="product-price text-center alt-font">Total Value</th>
                                            <th class="product-price text-center alt-font">Order ID</th>
                                            <th class="stock-status text-center alt-font">Payment Method</th>
                                            <th class="status text-center alt-font">Status</th>
                                            <th class="status text-center alt-font">Status Update</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for order_group in grouped_orders %}
                                            {% set first_order = order_group.orders[0] %}
                                            <tr>
                                                <!-- Customer Details -->
                                                <td class="text-center" rowspan="{{ order_group.rowspan }}">{{ first_order[0] }} {{ first_order[1] }}</td>
                                                <td class="text-center" rowspan="{{ order_group.rowspan }}">{{ first_order[3] }}</td>
                                                <td class="text-center" rowspan="{{ order_group.rowspan }}">{{ first_order[2] }}</td>
                                
                                                <!-- First Product Details -->
                                                <td class="text-center {% if first_order[16] == 'Cancelled' %}text-danger{% endif %}">{{ first_order[10] }} (Size: {{ first_order[11] }}, Color: {{ first_order[12] }}, Qty: {{ first_order[13] }})</td>
                                                <td class="text-center" rowspan="{{ order_group.rowspan }}">{{ first_order[15] }}, {{ first_order[4] }}, {{ first_order[5] }}, {{ first_order[6] }}</td>
                                                <td class="text-center">₹ {{ first_order[14] }}</td>
                                                <td class="text-center" rowspan="{{ order_group.rowspan }}">₹ {{ order_group.total_value }}</td>
                                                <td class="text-center" rowspan="{{ order_group.rowspan }}">{{ first_order[8] }}</td>
                                                <td class="text-center" rowspan="{{ order_group.rowspan }}">{{ first_order[7]}}</td>
                                                <td class="text-center">
                                                    <input type="hidden" name="razorpay_order_id" value="{{ first_order[8] }}">
                                                    <input type="hidden" name="productname" value="{{ first_order[10] }}">
                                                    <input type="hidden" name="color" value="{{ first_order[12] }}">
                                                    <select name="status" id="status_{{ first_order[8] }}_{{ first_order[10] }}_{{ first_order[12] }}">
                                                        <option value="Placed" {% if first_order[16] == 'Placed' %}selected{% endif %}>Placed</option>
                                                        <option value="Shipped" {% if first_order[16] == 'Shipped' %}selected{% endif %}>Shipped</option>
                                                        <option value="Delivered" {% if first_order[16] == 'Delivered' %}selected{% endif %}>Delivered</option>
                                                    </select>
                                                </td>
                                                <td><button type="button" onclick="updateOrderStatus('{{ first_order[8] }}', '{{ first_order[10] }}', '{{ first_order[12] }}')">Update</button></td>
                                            </tr>
                                
                                            <!-- Additional Product Rows -->
                                            {% for product in order_group.orders[1:] %}
                                            <tr>
                                                <td class="text-center {% if product[16] == 'Cancelled' %}text-danger{% endif %}">{{ product[10] }} (Size: {{ product[11] }}, Color: {{ product[12] }}, Qty: {{ product[13] }})</td>
                                                <td class="text-center">₹ {{ product[14] }}</td>
                                                <td class="text-center">
                                                    <select name="status" id="status_{{ product[8] }}_{{ product[10] }}_{{ product[12] }}">
                                                        <option value="Placed" {% if product[16] == 'Placed' %}selected{% endif %}>Placed</option>
                                                        <option value="Shipped" {% if product[16] == 'Shipped' %}selected{% endif %}>Shipped</option>
                                                        <option value="Delivered" {% if product[16] == 'Delivered' %}selected{% endif %}>Delivered</option>
                                                    </select>
                                                </td>
                                                <td>
                                                    <button type="button" onclick="updateOrderStatus('{{ product[8] }}', '{{ product[10] }}', '{{ product[12] }}')">Update</button>

                                                </td>
                                            </tr>
                                            {% endfor %}
                                        {% endfor %}
                                    </tbody>
                                </table>
                                
                            </div>
                        </form>
                    </div>
                </div>
            </div>
            
            
            

            <div class="container" id="editProductTable" style="display: none;">
                <div class="row">
                    
                    <div class="col-12 col-sm-12 col-md-12 col-lg-12 main-col">
                        <h2 style="color: #deb992;">Edit Product</h2>
                        <form action="#">
                            <div class="wishlist-table table-content table-responsive">
                                <table class="table table-bordered">
                                    <thead>
                                        <tr>
                                            <th class="product-name text-center alt-font">Product name</th>
                                            <th class="product-price text-center alt-font">SKU</th>
                                            <th class="product-subtotal text-center alt-font">Color</th>
                                            <th class="product-name alt-font text-center">Price</th>
                                            <th class="product-name alt-font text-center">Quantity</th>
                                            <th class="product-price text-center alt-font">Category</th>
                                            <th class="stock-status text-center alt-font">Size</th>
                                            <th class="stock-status text-center alt-font">Vendor</th>
                                            <th>EDIT</th>
                                            <th>DELETE</th>
                                            

                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for pro in product %}
                                        <tr>
                                            <td class="product-remove text-center" valign="middle">{{pro[0]}}
                                            </td>
                                            <td class="product-thumbnail text-center">
                                                {{pro[7]}}
                                            </td>
                                            <td class="product-name text-center">{{pro[2]}}</td>
                                            <td class="product-price text-center"><span
                                                    class="amount"> ₹ {{pro[3]}}</span></td>
                                            <td class="stock text-center">
                                            {{pro[8]}}
                                            </td>
                                            <td class="product-subtotal text-center">{{pro[9]}}</td>
                                            <td class="product-subtotal text-center">{{pro[11]}}</td>
                                            <td class="product-subtotal text-center">{{pro[17]}}</td>
                                            <td><a href="{{ url_for('edit_product', sku=pro[7]) }}" class="action-btn cancel-btn">Edit</a></td>
                                            <td><button class="action-btn cancel-btn" onclick="deleteProduct('{{ pro[7] }}')">DELETE</button></td>
                                        </tr>
                                        {% endfor %}


                                    </tbody>
                                </table>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <div class="container" id="returnTable" style="display: none;">
                <div class="row">
                    <div class="col-12 col-sm-12 col-md-12 col-lg-12 main-col">
                        <h2 style="color: #deb992;">Return Requests</h2>

                        <form action="#">
                            <div class="wishlist-table table-content table-responsive">
                                <table class="table table-bordered">
                                    <thead>
                                        <tr>
                                            <th class="product-name text-center alt-font">Customer name</th>
                                            <th class="product-price text-center alt-font">Phone No.</th>
                                            <th class="product-subtotal text-center alt-font">Email</th>
                                            <th class="product-name alt-font text-center">Product details</th>
                                            <th class="product-name alt-font text-center">Billing Address</th>
                                            <th class="product-price text-center alt-font">Order Value</th>
                                            <th class="product-price text-center alt-font">Order ID</th>
                                            <th class="stock-status text-center alt-font">Payment Method</th>
                                            <th class="product-name alt-font text-center">Reason</th>
                                            <th class="product-name alt-font text-center">Images</th>
                                            <th class="product-name alt-font text-center">Details</th>
                                            <th class="product-name alt-font text-center">Status</th>

                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for request in return_requests %}
                                        <tr>
                                            <td class="product-remove text-center" valign="middle">{{request[0]}}
                                                {{request[1]}}</td>
                                            <td class="product-thumbnail text-center">
                                                {{request[2]}}
                                            </td>
                                            <td class="product-name text-center">{{request[9]}}</td>
                                            <td class="text-center">
                                                {{ request[10] }} (Size: {{ request[11] }}, Color: {{ request[12] }}, Qty: {{ request[13] }})
                                            </td>
                                            <td class="stock text-center">
                                                <span class="in-stock">{{request[3]}}, {{request[4]}}, {{request[5]}}, {{request[6]}}</span>
                                            </td>
                                            <td class="product-subtotal text-center"> ₹ {{request[14]}}</td>
                                            <td class="product-subtotal text-center">{{request[7]}}</td>
                                            <td class="product-subtotal text-center">{{request[8]}}</td>
                                            <td class="product-subtotal text-center">{{request[15]}}</td>
                                            <td class="product-subtotal text-center">
                                                {% if request[17] and request[18] %}
                                                    <a href="{{ request[17] }}" target="_blank">Image1</a>, 
                                                    <a href="{{ request[18] }}" target="_blank">Image2</a>
                                                {% else %}
                                                    No images
                                                {% endif %}
                                            </td>
                                            <td class="product-subtotal text-center">{{request[16]}}</td>
                                            <td class="product-status text-center">
                                                <input type="hidden" name="razorpay_order_id" value="{{ request[7] }}">
                                                <input type="hidden" name="productname" value="{{ request[10] }}">
                                                <input type="hidden" name="color" value="{{ request[12] }}">
                                                <select name="returnstatus" id="returnstatus_{{ request[7] }}_{{ request[10] }}_{{ request[12] }}">
                                                    <option value="Placed" {% if request[19] == 'Placed' %}selected{% endif %}>Placed</option>
                                                    <option value="Shipped" {% if request[19] == 'Shipped' %}selected{% endif %}>Shipped</option>
                                                    <option value="Delivered" {% if request[19] == 'Delivered' %}selected{% endif %}>Delivered</option>
                                                </select>
                                                <button type="button" onclick="updateReturnStatus('{{ request[7] }}','{{ request[10] }}','{{ request[12] }}')">Update</button>
                                            </td>
                                            
                                        </tr>
                                        {% endfor %}


                                    </tbody>
                                </table>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <div class="container" id="CancelTable" style="display: none;">
                <div class="row">
                    <div class="col-12 col-sm-12 col-md-12 col-lg-12 main-col">
                        <h2 style="color: #deb992;">Cancelled Orders</h2>

                        <form action="#">
                            <div class="wishlist-table table-content table-responsive">
                                <table class="table table-bordered">
                                    <thead>
                                        <tr>
                                            <th class="product-name text-center alt-font">Customer name</th>
                                            <th class="product-price text-center alt-font">Phone No.</th>
                                            <th class="product-subtotal text-center alt-font">Email</th>
                                            <th class="product-name alt-font text-center">Product Details</th>
                                            <th class="product-name alt-font text-center">Billing Address</th>
                                            <th class="product-price text-center alt-font">Order Value</th>
                                            <th class="product-price text-center alt-font">Order ID</th>
                                            <th class="stock-status text-center alt-font">Payment Method</th>
                                           

                                        </tr>
                                    </thead>
                                    <tbody>
                                    
                                        {% for order in cancel %}
                                        <tr>
                                            <td class="product-remove text-center" valign="middle">{{order[0]}}
                                                {{order[1]}}</td>
                                            <td class="product-thumbnail text-center">
                                                {{order[3]}}
                                            </td>
                                            <td class="product-name text-center">{{order[2]}}</td>
                                            <td class="text-center">
                                                {{order[10]}} (Size: {{order[11]}}, Color: {{order[12]}}, Qty: {{order[13]}})
                                            </td>
                                            <td class="stock text-center">
                                                <span class="in-stock">{{order[15]}}, {{order[4]}}, {{order[5]}}, {{order[6]}}</span>
                                            </td>
                                            <td class="product-subtotal text-center"> ₹ {{order[14]}}</td>
                                            <td class="product-subtotal text-center">{{order[8]}}</td>
                                            <td class="product-subtotal text-center">{{order[7]}}</td>
                                            
                                            
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

        </div>
        <!--End Body Content-->

        <!--Footer-->
        <footer id="footer">


            <div class="site-footer">
        
                <div class="container">
                    <hr>
                    <!--Footer Links-->
                    <div class="footer-top">
        
                        <div class="row">
                            <div class="col-12 col-sm-12 col-md-3 col-lg-3 footer-links">
                                <h4 class="h4">Quick Shop</h4>
                                <ul>
                                    <li><a href="/shopwomen">Women</a></li>
                                    <li><a href="/shopfullwidth">Men</a></li>
                                    <li><a href="#">Kids</a></li>
                                    <li><a href="#">Footwear</a></li>
                                </ul>
                            </div>
                            <div class="col-12 col-sm-12 col-md-3 col-lg-3 footer-links">
                                <h4 class="h4">Informations</h4>
                                <ul>
                                    <li><a href="/aboutus">About us</a></li>
                                    <!-- <li><a href="#">Careers</a></li>
                                    <li><a href="#">Privacy policy</a></li>
                                    <li><a href="#">Terms &amp; condition</a></li> -->
                                    <li><a href="/myaccount">My Account</a></li>
                                </ul>
                            </div>
                            <div class="col-12 col-sm-12 col-md-3 col-lg-3 footer-links">
                                <h4 class="h4">Customer Services</h4>
                                <ul>
                                    <!-- <li><a href="#">Request Personal Data</a></li>
                                    <li><a href="#">FAQ's</a></li> -->
                                    <li><a href="/contactus">Contact Us</a></li>
                                    <li><a href="#">Orders and Returns</a></li>
                                    <!-- <li><a href="#">Support Center</a></li> -->
                                </ul>
                            </div>
                            <div class="col-12 col-sm-12 col-md-3 col-lg-3 contact-box">
                                <h4 class="h4">Contact Us</h4>
                                <ul class="addressFooter">
                                    <li><i class="icon anm anm-map-marker-al" style="color: #deb992 !important;"></i>
                                        <p>55 Gallaxy Enque,<br>2568 steet, 23568 NY</p>
                                    </li>
                                    <li class="phone"><i class="icon anm anm-phone-s"
                                            style="color: #deb992 !important; "></i>
                                        <p>+91 123456789</p>
                                    </li>
                                    <li class="email"><i class="icon anm anm-envelope-l"
                                            style="color: #deb992 !important; "></i>
                                        <p>sales@yousite.com</p>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <!--End Footer Links-->
                    <hr>
                    <div class="footer-bottom">
        
                        <p class="text-center" style="font-size: medium; font-weight: 500; color: #1ba098;">Designed By
                            Websharks</p>
        
                    </div>
                </div>
            </div>
        </footer>
        <!--End Footer-->
        <!--Scoll Top-->
        <span id="site-scroll"><i class="icon anm anm-angle-up-r"></i></span>
        <!--End Scoll Top-->

        <!-- Including Jquery -->
        <script src="../static/js/vendor/jquery-3.3.1.min.js"></script>
        <script src="../static/js/vendor/jquery.cookie.js"></script>
        <script src="../static/js/vendor/modernizr-3.6.0.min.js"></script>
        <script src="../static/js/vendor/wow.min.js"></script>
        <!-- Including Javascript -->
        <script src="../static/js/bootstrap.min.js"></script>
        <script src="../static/js/plugins.js"></script>
        <script src="../static/js/popper.min.js"></script>
        <script src="../static/js/lazysizes.js"></script>
        <script src="../static/js/main.js"></script>
    </div>

    <script>
        function showEditProduct() {
            document.getElementById("editProductTable").style.display = "block";
            document.getElementById("orderHistoryTable").style.display = "none";
            document.getElementById("returnTable").style.display = "none";
            document.getElementById("CancelTable").style.display = "none";
        }
    
        function showOrderHistory() {
            document.getElementById("editProductTable").style.display = "none";
            document.getElementById("orderHistoryTable").style.display = "block";
            document.getElementById("returnTable").style.display = "none";
            document.getElementById("CancelTable").style.display = "none";
        }

        function showReturnHistory(){
            document.getElementById("editProductTable").style.display = "none";
            document.getElementById("orderHistoryTable").style.display = "none";
            document.getElementById("returnTable").style.display = "block";
            document.getElementById("CancelTable").style.display = "none";
        }
        function showCancelled() {
            document.getElementById("editProductTable").style.display = "none";
            document.getElementById("orderHistoryTable").style.display = "none";
            document.getElementById("returnTable").style.display = "none";
            document.getElementById("CancelTable").style.display = "block";
        }
    </script>


<script>
    function deleteProduct(sku) {
        if (confirm("Are you sure you want to delete this product?")) {
            fetch(`/delete-product/${sku}`, {
                method: 'DELETE',
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert("Product deleted successfully!");
                    location.reload();  // Reloads the page to reflect the deleted item
                } else {
                    alert("Failed to delete product. Please try again.");
                }
            })
            .catch(error => console.error("Error:", error));
        }
    }
    </script>

<script>
    function updateOrderStatus(orderId, productName, color) {
        var status = document.getElementById('status_' + orderId + '_' + productName + '_' + color).value;
    
        $.ajax({
            url: '/update-order-status',
            type: 'POST',
            data: {
                razorpay_order_id: orderId,
                productname: productName,
                color: color,
                status: status
            },
            success: function(response) {
                console.log('Order updated successfully!');
                location.reload(); // Optionally reload the page to show updated status
            },
            error: function(xhr, status, error) {
                if (xhr.status === 403) {
                    alert("Cannot update status for a cancelled order.");
                } else {
                    alert("Error updating order status: " + error);
                }
            }
        });
    }
    </script>

<script>
    function updateReturnStatus(orderId, productName, color) {
        const status = document.getElementById('returnstatus_' + orderId + '_' + productName + '_' + color).value;
    
        $.ajax({
            url: '/update-return-status',
            type: 'POST',
            data: {
                razorpay_order_id: orderId,
                productname: productName,
                color: color,
                returnstatus: status
            },
            success: function(response) {
                console.log('Return updated successfully!');
                location.reload(); // Optionally reload the page to show updated status
            },
            error: function(xhr, status, error) {
                console.log('Error updating return status:', error);
            }
        });
    }
    </script>
    
    

</body>

<!-- belle/wishlist.html   11 Nov 2019 12:22:27 GMT -->

</html>